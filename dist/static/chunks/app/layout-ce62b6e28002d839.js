(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[177],{2728:()=>{},3007:(e,t,a)=>{"use strict";a.d(t,{A:()=>i,AuthProvider:()=>u});var s=a(5155),o=a(2115),l=a(5695),r=a(3464);let n=(0,o.createContext)(),i=()=>{let e=(0,o.useContext)(n);if(!e)throw Error("useAuth must be used within an AuthProvider");return e};function u(e){let{children:t}=e,[a,i]=(0,o.useState)(null),[u,d]=(0,o.useState)(!0),[c,h]=(0,o.useState)(null),m=(0,l.useRouter)();(0,o.useEffect)(()=>{r.A.defaults.baseURL="http://localhost:5000/api",r.A.defaults.withCredentials=!0},[]),(0,o.useEffect)(()=>{(async()=>{try{let e=localStorage.getItem("token");if(e){r.A.defaults.headers.common.Authorization="Bearer ".concat(e);let t=await r.A.get("/auth/me");i(t.data.user)}}catch(e){localStorage.removeItem("token"),delete r.A.defaults.headers.common.Authorization}finally{d(!1)}})()},[]);let p=async(e,t)=>{try{d(!0);let a=await r.A.post("/auth/login",{email:e,password:t});return i(a.data.user),localStorage.setItem("token",a.data.token),r.A.defaults.headers.common.Authorization="Bearer ".concat(a.data.token),m.push("/dashboard"),toast({title:"Login successful",description:"Welcome back, ".concat(a.data.user.name,"!")}),a.data}catch(e){var a,s,o,l;throw h((null==(s=e.response)||null==(a=s.data)?void 0:a.message)||"Login failed"),toast({variant:"destructive",title:"Login Failed",description:(null==(l=e.response)||null==(o=l.data)?void 0:o.message)||"Invalid credentials"}),e}finally{d(!1)}},f=async e=>{try{d(!0);let t=await r.A.post("/auth/register",e);return i(t.data.user),localStorage.setItem("token",t.data.token),r.A.defaults.headers.common.Authorization="Bearer ".concat(t.data.token),m.push("/dashboard"),toast({title:"Registration successful",description:"Welcome, ".concat(t.data.user.name,"!")}),t.data}catch(e){var t,a,s,o;throw h((null==(a=e.response)||null==(t=a.data)?void 0:t.message)||"Registration failed"),toast({variant:"destructive",title:"Registration Failed",description:(null==(o=e.response)||null==(s=o.data)?void 0:s.message)||"Could not create account"}),e}finally{d(!1)}},v=async()=>{try{await r.A.post("/auth/logout")}catch(e){console.error("Logout error:",e)}finally{i(null),localStorage.removeItem("token"),delete r.A.defaults.headers.common.Authorization,m.push("/login")}},g=async e=>{try{d(!0);let t=await r.A.put("/auth/profile",e);return i(t.data.user),toast({title:"Profile updated",description:"Your profile has been updated successfully"}),t.data}catch(e){var t,a,s,o;throw h((null==(a=e.response)||null==(t=a.data)?void 0:t.message)||"Update failed"),toast({variant:"destructive",title:"Update Failed",description:(null==(o=e.response)||null==(s=o.data)?void 0:s.message)||"Could not update profile"}),e}finally{d(!1)}},y=async e=>{try{d(!0),await r.A.put("/auth/change-password",e),toast({title:"Password updated",description:"Your password has been changed successfully"})}catch(e){var t,a,s,o;throw h((null==(a=e.response)||null==(t=a.data)?void 0:t.message)||"Password change failed"),toast({variant:"destructive",title:"Password Change Failed",description:(null==(o=e.response)||null==(s=o.data)?void 0:s.message)||"Could not update password"}),e}finally{d(!1)}};return(0,s.jsx)(n.Provider,{value:{user:a,loading:u,error:c,login:p,register:f,logout:v,updateProfile:g,changePassword:y,isAuthenticated:!!a,isAdmin:(null==a?void 0:a.role)==="admin",isManager:(null==a?void 0:a.role)==="manager"},children:t})}},4917:e=>{e.exports={style:{fontFamily:"'Geist', 'Geist Fallback'",fontStyle:"normal"},className:"__className_5cfdac",variable:"__variable_5cfdac"}},5455:e=>{e.exports={style:{fontFamily:"'Geist Mono', 'Geist Mono Fallback'",fontStyle:"normal"},className:"__className_9a8899",variable:"__variable_9a8899"}},5695:(e,t,a)=>{"use strict";var s=a(8999);a.o(s,"usePathname")&&a.d(t,{usePathname:function(){return s.usePathname}}),a.o(s,"useRouter")&&a.d(t,{useRouter:function(){return s.useRouter}})},9922:(e,t,a)=>{Promise.resolve().then(a.t.bind(a,4917,23)),Promise.resolve().then(a.t.bind(a,5455,23)),Promise.resolve().then(a.t.bind(a,2728,23)),Promise.resolve().then(a.bind(a,3007))}},e=>{var t=t=>e(e.s=t);e.O(0,[815,690,464,441,684,358],()=>t(9922)),_N_E=e.O()}]);